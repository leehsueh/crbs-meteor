<head>
  <title>crbsapp</title>
</head>

<body>
  <div class="container">
    {{renderPage}}
  </div>
</body>

<template name="passage_form">
  <h3>Add a Passage</h3>
  <form class="form form-horizontal">
    <input type="text" id="new-reference"> <button class="btn btn-add">Add</button>
    {{#if errorMessage}}&nbsp;&nbsp;<span class="text-error">{{errorMessage}} [<a href="#" class="close-alert">close</a>]</span>{{/if}}
  </form>
</template>

<template name="passage_block">
  <div class="well">
    <h3>{{reference}}{{#if readOnly }} {{else}} <small><a href="#" class="btn-delete-passage">Remove</a></small>{{/if}}</h3>
    <div class="passage-content scrollable-region" style="height:400px">
      {{{passage_text}}}
    </div>
  </div>
</template>

<template name="passages_area">
  <!-- <h2>{{passages.count}} Passages</h2> -->
  <div class="row-fluid">
    <ul class="thumbnails">
      {{#each passages}}
      <li class="span4">
        <div class="thumbnail">
        {{> passage_block}}    
        </div>
      </li>
      {{/each}}
    </ul>
  </div>
</template>

<template name="space">
  {{#if dataLoaded}}
    {{#with space}}
      <ul class="breadcrumb">
        <li><a href="/">Spaces</a> <span class="divider">/</span></li>
        <li>{{name}}</li>
      </ul>
      <h1>
        {{#if read_only}}
          {{name}}
        {{else}}
          <span class="editable-space-name" contenteditable=true>{{name}}</span> <small class="show-on-hover">click to edit</small>
        {{/if}}
      </h1>
      {{#if read_only}}
        <p>{{passage_refs.length}} passage(s)</p>
      {{else}}
        {{> passage_form space}}
      {{/if}}
      {{> passages_area}}

      <div id="notes-container">
        <a href="#" class="toggle-notes">Toggle</a>
        <h2>Notes <small><a href="#" class="btn-clear-chat">[clear chat]</a></small></h2>
        <ul class="unstyled notes-list scrollable-region">
          {{#each space.notes}}
          <li><span class="label">{{noteAuthor}}</span>: {{noteText}}</li>
          {{/each}}
        </ul>
        <form>
          <input type="text" class="input-block-level" id="new-note">
          <button class="btn btn-block btn-add-note">Add Note as {{currentAuthor}}</button>
        </form>
      </div>
    {{/with}}
  {{else}}
    <p>Loading Space...</p>
  {{/if}}
</template>

<template name="spaces">
  <h2>Spaces</h2>
  {{#if dataLoaded}}
  <table class="table">
    <thead>
      <tr>
        <th>Name</th>
        <th>Passages</th>
        <th>Permissions</th>
        <th></th>
      </tr>
    </thead>
    <tbody>
    {{#each spaces}}
      <tr>
        <td><a href="/space/{{_id}}">{{name}}</a></td>
        <td>{{listed_passage_refs}}</td>
        <td>{{#if read_only}}
          <i class="icon-eye-open"></i>
          {{else}}
          <i class="icon-pencil"></i>
          {{/if}}
        </td>
        <td><a href="#" class="delete"><i class="icon-remove"> Delete</i></a></td>
      </tr>
    {{/each}}
    </tbody>
  </table>
  <div class="well">
    <div class="input-append">
      <input class="span2" id="new-space-name" placeholder="create a new space" type="text">
      <button class="btn btn-primary" type="button">Add!</button>
    </div>
  </div>
  {{else}}
  <p>Loading...</p>
  {{/if}}
</template>